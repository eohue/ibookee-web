# 📸 이미지 업로드가 사라지는 문제 해결 가이드 (AWS S3 설정)

안녕하세요! 현재 웹사이트에서 이미지를 업로드하면 **서버가 재시작될 때마다 이미지가 사라지는 문제**가 발생하고 있습니다. 이는 이미지를 저장할 "영구적인 공간"이 연결되어 있지 않기 때문입니다.

이 문제를 해결하기 위해 가장 대중적이고 확실한 방법인 **AWS S3 (아마존 클라우드 저장소)**를 연결하는 방법을 아주 상세하게 설명해 드리겠습니다. 천천히 따라해 주세요.

---

## 🧐 왜 이 작업을 해야 하나요?
현재 방식은 공책(서버)에 글씨를 쓰는데, 공책을 덮을 때마다(서버 재시작) 지우개로 싹 지워지는 것과 같습니다.
**AWS S3**는 "절대 지워지지 않는 금고"와 같습니다. 이곳에 이미지를 저장하면 서버가 꺼지든 켜지든 이미지가 안전하게 보관됩니다.

---

## 1단계: AWS 가입 및 로그인
1. [AWS 콘솔(클릭)](https://aws.amazon.com/ko/console/)에 접속합니다.
2. 계정이 없다면 '무료 계정 생성'을 진행해 주세요. (해외 결제 가능한 카드가 필요합니다.)
3. 로그인을 완료합니다.

## 2단계: 버킷(이미지 저장소) 만들기
이미지를 담을 '양동이(Bucket)'를 만드는 과정입니다.

1. 콘솔 상단 검색창에 **`S3`**라고 입력하고 클릭합니다.
2. 주황색 **[버킷 만들기]** 버튼을 클릭합니다.
3. 설정 화면에서 다음 항목들을 입력합니다:
    *   **버킷 이름**: 영어 소문자와 숫자로 나만의 이름을 짓습니다. (예: `ibookee-images-2025`) -> **이 이름을 기억해두세요!**
    *   **AWS 리전**: `아시아 태평양(서울) ap-northeast-2`를 선택합니다.
    *   **객체 소유권**: 'ACL 비활성화됨(권장)' 그대로 둡니다.
    *   **이 버킷의 퍼블릭 액세스 차단 설정**: 
        *   ✅ **'모든 퍼블릭 액세스 차단' 체크박스를 해제합니다.** (체크를 풉니다!)
        *   아래에 나오는 경고 체크박스('현재 설정으로 인해...')에 ✅ 체크하여 승인합니다.
             *(웹사이트에서 누구나 이미지를 볼 수 있어야 하므로 풀어주는 것입니다)*
4. 맨 아래로 내려가 **[버킷 만들기]**를 클릭합니다.

## 3단계: 버킷 권한 설정 (중요!)
만들어진 버킷에 웹사이트가 접근할 수 있도록 허락해주는 과정입니다.

1. 방금 만든 버킷의 이름(`ibookee-images-2025`)을 클릭해서 들어갑니다.
2. 상단 탭 메뉴 중 **[권한 (Permissions)]**을 클릭합니다.
3. 아래로 스크롤하여 **'버킷 정책 (Bucket policy)'** 섹션에 있는 **[편집]** 버튼을 늘릅니다.
4. 아래 코드를 복사해서 붙여넣습니다. 
   ⚠️ **주의**: `"Bucket-Name"` 부분을 위에서 지은 **본인의 버킷 이름**으로 바꿔주세요!

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "PublicReadGetObject",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::Bucket-Name/*"
        }
    ]
}
```
*(예: 버킷 이름이 `my-test`라면 `"arn:aws:s3:::my-test/*"`가 되어야 합니다)*

5. **[변경 사항 저장]**을 클릭합니다.

## 4단계: 접속 열쇠(Access Key) 받기
웹사이트가 금고를 열 수 있는 '열쇠'를 발급받는 과정입니다.

1. 상단 검색창에 **`IAM`**이라고 입력하고 클릭합니다.
2. 왼쪽 메뉴에서 **[사용자 (Users)]**를 클릭합니다.
3. **[사용자 생성]** 주황색 버튼을 클릭합니다.
4. **사용자 이름**: `ibookee-admin` 등으로 짓고 [다음]을 누릅니다.
5. **권한 설정**:
    *   '직접 정책 연결'을 선택합니다.
    *   권한 정책 목록 검색창에 `S3Full`이라고 치면 나오는 **`AmazonS3FullAccess`**에 체크합니다.
    *   [다음] -> [사용자 생성]을 완료합니다.
6. 방금 만든 사용자(`ibookee-admin`) 이름을 클릭해 들어갑니다.
7. **[보안 자격 증명]** 탭을 클릭합니다.
8. '액세스 키' 섹션에서 **[액세스 키 만들기]**를 클릭합니다.
9. 사용 사례로 **'로컬 코드'** 또는 **'기타'**를 선택하고 체크박스 확인 후 [다음] -> [액세스 키 만들기]를 완료합니다.
10. **(매우 중요)** 화면에 나온 **`액세스 키(Access key ID)`**와 **`비밀 액세스 키(Secret access key)`**를 메모장에 복사해 둡니다. 이 창을 닫으면 비밀 키는 다시 볼 수 없습니다!

---

## 5단계: 웹사이트에 연결하기 (마지막!)

이제 얻은 정보들을 웹사이트의 설정 파일(`.env`)에 적어주면 됩니다.

1. 프로젝트 폴더에 있는 `.env` 파일을 엽니다.
2. 맨 아래에 다음 내용을 추가합니다. (복사해둔 값들을 채워넣으세요)

```env
# AWS S3 설정
AWS_ACCESS_KEY_ID=복사해둔_액세스_키 (AKIA...)
AWS_SECRET_ACCESS_KEY=복사해둔_비밀_키
AWS_REGION=ap-northeast-2
AWS_BUCKET_NAME=2단계에서_만든_버킷_이름
```

3. 파일을 저장합니다.
4. 서버를 재시작(`Ctrl+C` 후 `npm run dev`)합니다.

---

## 🎉 완료되었습니다!
이제 이미지를 업로드해보세요.
1. 관리자 페이지에서 이미지를 업로드합니다.
2. 이미지가 정상적으로 보입니다.
3. 서버를 껐다 켜도, 나중에 배포를 해도 이미지가 사라지지 않고 계속 잘 보일 것입니다.

궁금한 점이 있거나 막히는 부분이 있다면 언제든 물어봐 주세요!
